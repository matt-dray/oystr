<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to {oystr} • oystr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to {oystr}">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oystr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/oystr-intro.html">Introduction to {oystr}</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/matt-dray/oystr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to {oystr}</h1>
                        <h4 class="author">Matt Dray</h4>
            
            <h4 class="date">2019-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/matt-dray/oystr/blob/master/vignettes/oystr-intro.Rmd"><code>vignettes/oystr-intro.Rmd</code></a></small>
      <div class="hidden name"><code>oystr-intro.Rmd</code></div>

    </div>

    
    
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>You can use the {oystr} package to process <a href="https://oyster.tfl.gov.uk/">Oyster card</a> journey data in CSV files provided by <a href="https://tfl.gov.uk/">Transport for London</a> (TfL).</p>
<p>Provide a file path to <code><a href="../reference/oy_read.html">oy_read()</a></code> that contains the CSVs, then use <code>data_clean()</code> to prepare the data and extract new features ready for further processing and summarisation.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"matt-dray/oystr"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(oystr)</a>
<a class="sourceLine" id="cb1-3" title="3">data_raw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/oy_read.html">oy_read</a></span>(<span class="dt">path =</span> <span class="st">"path/to/data"</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">data_clean &lt;-<span class="st"> </span><span class="kw"><a href="../reference/oy_clean.html">oy_clean</a></span>(<span class="dt">x =</span> data_raw)</a></code></pre></div>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p><a href="https://tfl.gov.uk">Transport for London</a> (TfL) is responsible for the majority of the transport network in the UK’s capital. Transport options include overground and underground trains, buses, trams and riverboats.</p>
<p>TfL operates the <a href="https://oyster.tfl.gov.uk/">Oyster card</a> system on its network. You can charge the card with funds and get access to the network by tapping in your card on a special reader.</p>
<p>Your card has a unique number and this is recorded each time you ‘tap in’ and ‘tap out’ of the network. TfL stores this data for consumption by users for eight weeks. You can view your history on the TfL website or you can be sent a monthly digest by email.</p>
<p>In both cases you can collect the data as a CSV file. This is in more of a human-readable form than machine-readable, which can make it difficult to perform further processing from a programmatic perspective.</p>
</div>
<div id="oyster-data" class="section level1">
<h1 class="hasAnchor">
<a href="#oyster-data" class="anchor"></a>Oyster data</h1>
<p>TfL provide the data in a consistent format. Here are the first few rows from an anonymised example where the locations and services have been replaced.</p>
<pre><code>#&gt;             X        X.1      X.2                    X.3    X.4    X.5
#&gt; 1        Date Start Time End Time         Journey/Action Charge Credit
#&gt; 2 31-Jul-2018      16:11    16:50 Station A to Station B      0   &lt;NA&gt;
#&gt; 3 31-Jul-2018      06:47    07:34 Station B to Station A      0   &lt;NA&gt;
#&gt; 4 28-Jul-2018      18:57    19:44 Station C to Station R      0   &lt;NA&gt;
#&gt; 5 28-Jul-2018      13:49    14:43 Station R to Station L      0   &lt;NA&gt;
#&gt; 6 26-Jul-2018      17:51    19:18 Station D to Station R      0   &lt;NA&gt;
#&gt;       X.6  X.7
#&gt; 1 Balance Note
#&gt; 2       8 &lt;NA&gt;
#&gt; 3       8 &lt;NA&gt;
#&gt; 4       8 &lt;NA&gt;
#&gt; 5       8 &lt;NA&gt;
#&gt; 6       8 &lt;NA&gt;</code></pre>
<p>The resulting data frame has some problems. For example:</p>
<ul>
<li>the first row of the CSV is blank, so the column headers end up as the first row of data in the data frame</li>
<li>the date is recorded for the journey start only, even thtough the journey end could be the next day</li>
<li>Journey/Action contains multiple types of information, like the start station, end station and bus journeys</li>
<li>the data types for each are not correct (<code>Date</code> is not in date-time format, for example)</li>
</ul>
<p>The aim of the {oystr} package is to help address these issues and more.</p>
</div>
<div id="reading-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-the-data" class="anchor"></a>Reading the data</h1>
<p>The <code><a href="../reference/oy_read.html">oy_read()</a></code> function reads and combines multiple CSV files of Oyster data. The function takes one argument: a string that is the path to a folder containing your Oyster data files.</p>
<p>The names of the files don’t matter, but the structure of each of them must be in the format provided by TfL.</p>
<p>For example, the file path in the example below leads to a folder containing four files: two are CSVs containing monthly Oyster data in the format supplied by TfL (<code>july.csv</code> and <code>august.csv</code>) and the other two are a CSV and a text file that don’t contain Oyster data (<code>not_oyster.csv</code> and <code>not_oyster.txt</code>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># File path to a folder containing oyster data</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co"># Replace this path with your own</span></a>
<a class="sourceLine" id="cb3-3" title="3">filepath &lt;-<span class="st"> "../inst/extdata/"</span></a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co"># Print the file names at that path</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list.files">list.files</a></span>(filepath)</a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">#&gt; [1] "august.csv"     "july.csv"       "not_oyster.csv" "not_oyster.txt"</span></a></code></pre></div>
<p>So we need to read the two CSVs of Oyster data and ignore the others. The {oystr} package can help you. You can install it from GitHub and then load it.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Install the {remotes} package to help install {oystr} </span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"remotes"</span>)</a>
<a class="sourceLine" id="cb4-3" title="3">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"matt-dray/oystr"</span>)</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co"># Load the package</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(oystr)</a></code></pre></div>
<p>The functions of the {oystr} package are now available to you.</p>
<p>Use the <code><a href="../reference/oy_read.html">oy_read()</a></code> function to read the data sets. To the ‘path’ argument provide a file path to a folder containing your files. Here I’ve used the filepath created in teh sectio above.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Read data from a folder</span></a>
<a class="sourceLine" id="cb5-2" title="2">data_raw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/oy_read.html">oy_read</a></span>(<span class="dt">path =</span> filepath)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; Warning in oy_read(path = filepath): 1 CSV file wasn't in the expected</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; format and was discarded</span></a></code></pre></div>
<p>This gave a warning for one CSV file that was in the wrong format – the function identified that it didn’t contain Oyster data. The text file was ignored.</p>
<p>Let’s take a look at the structure of the data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(data_raw)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&gt; 'data.frame':    102 obs. of  8 variables:</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt;  $ Date          : chr  "31-Aug-2018" "31-Aug-2018" "28-Aug-2018" "28-Aug-2018" ...</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt;  $ Start.Time    : chr  "16:11" "06:47" "18:57" "13:49" ...</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt;  $ End.Time      : chr  "16:50" "07:34" "19:44" "14:43" ...</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt;  $ Journey.Action: chr  "Station A to Station B" "Station B to Station A" "Station C to Station R" "Station R to Station L" ...</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt;  $ Charge        : chr  "0" "0" "0" "0" ...</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt;  $ Credit        : chr  "NA" "NA" "NA" "NA" ...</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt;  $ Balance       : num  8 8 8 8 8 8 8 8 8 8 ...</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt;  $ Note          : chr  "NA" "NA" "NA" "NA" ...</span></a></code></pre></div>
<p>So we have</p>
<p>The output data frame contains rows of data from both CSV files. We can tell because it has data from both months of the input data frames (July and August in this example).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Count rows from each month of input data</span></a>
<a class="sourceLine" id="cb7-2" title="2">july &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"Jul"</span>, data_raw<span class="op">$</span>Date))</a>
<a class="sourceLine" id="cb7-3" title="3">august &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"Aug"</span>, data_raw<span class="op">$</span>Date))</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co"># Check their sum equals the output from oy_read()</span></a>
<a class="sourceLine" id="cb7-6" title="6">july <span class="op">+</span><span class="st"> </span>august <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(data_raw)</a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="cleaning-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#cleaning-the-data" class="anchor"></a>Cleaning the data</h1>
<p>There’s still a number of problems after the data is read in and the blank first row is removed. For example:</p>
<ul>
<li>dates and times are character types, not datettime</li>
<li>charge and credit are also character types</li>
<li>different types of data (bus trips and train journeys) are in the same <code>Journey.Action</code> column</li>
</ul>
<p>You can clean up the formatting and engineer new features with <code><a href="../reference/oy_clean.html">oy_clean()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># Clean the output from oy_read()</span></a>
<a class="sourceLine" id="cb8-2" title="2">data_clean &lt;-<span class="st"> </span><span class="kw"><a href="../reference/oy_clean.html">oy_clean</a></span>(data_raw)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co"># See the data frame structure</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(data_clean) </a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt; 'data.frame':    102 obs. of  13 variables:</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt;  $ datetime_start  : POSIXct, format: "2018-08-31 16:11:00" "2018-08-31 06:47:00" ...</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt;  $ datetime_end    : POSIXct, format: "2018-08-31 16:50:00" "2018-08-31 07:34:00" ...</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">#&gt;  $ weekday_start   : chr  "Friday" "Friday" "Tuesday" "Tuesday" ...</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt;  $ journey_duration: 'difftime' num  39 47 47 54 ...</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt;   ..- attr(*, "units")= chr "mins"</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt;  $ mode            : chr  "Train" "Train" "Train" "Train" ...</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt;  $ station_start   : chr  "Station A" "Station B" "Station C" "Station R" ...</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co">#&gt;  $ station_end     : chr  "Station B" "Station A" "Station R" "Station L" ...</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co">#&gt;  $ bus_route       : chr  NA NA NA NA ...</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co">#&gt;  $ payment         : chr  NA NA NA NA ...</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="co">#&gt;  $ charge          : chr  "0" "0" "0" "0" ...</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">#&gt;  $ credit          : chr  "NA" "NA" "NA" "NA" ...</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co">#&gt;  $ balance         : num  8 8 8 8 8 8 8 8 8 8 ...</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="co">#&gt;  $ note            : chr  "NA" "NA" "NA" "NA" ...</span></a></code></pre></div>
<p>So what did <code><a href="../reference/oy_clean.html">oy_clean()</a></code> do? You can see there are some new and altered columns:</p>
<ul>
<li>
<a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> date-times for the start and end of the journey, where applicable (takes into account journeys that start before midnight and end after)</li>
<li>day of the week for separating work-week from weekend</li>
<li>journey duration, a difftime object, in minutes</li>
<li>the mode of travel (train, bus, etc)</li>
<li>the start and end stations separated</li>
<li>the number of the bus route</li>
</ul>
<p>The data are now in a suitable shape for further processing, such as summarisation and visualisation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#summary">Summary</a></li>
      <li><a href="#background">Background</a></li>
      <li><a href="#oyster-data">Oyster data</a></li>
      <li><a href="#reading-the-data">Reading the data</a></li>
      <li><a href="#cleaning-the-data">Cleaning the data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matt Dray.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
